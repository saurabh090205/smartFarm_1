<head>
  <meta charset="UTF-8">
  <title>Smart Fertilizer Recommendation</title>
  <link rel="stylesheet" href="styelf.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
  <div class="container">
    <h2>Smart Fertilizer Recommendation System</h2>

    <form id="fertilizerForm">
      <label>Temperature  (in degree Celsius - рд╣рд╡реЗрдЪрд╛ рддрд╛рдкрдорд╛рди):</label>
      <input type="number" name="Temperature" required>

      <label>Moisture (in percentage (%) - рдорд╛рддреАрддреАрд▓ рдУрд▓рд╛рд╡рд╛):</label>
      <input type="number" name="Moisture" required>

      <label>Rainfall (in millimeters - рдкрд╛рд╡рд╕рд╛рдЪреЗ рдкреНрд░рдорд╛рдг):</label>
      <input type="number" name="Rainfall" required>

      <label>PH (range 0 to 14 - рдорд╛рддреАрдЪрд╛ рдЖрдореНрд▓рддрд╛/рдХреНрд╖рд╛рд░рддрд╛ рд╕реНрддрд░):</label>
      <input type="number" step="0.1" name="PH" required>

      <label>Nitrogen (in kg per hectare - рдирд╛рдпрдЯреНрд░реЛрдЬрди рдкреНрд░рдорд╛рдг):</label>
      <input type="number" name="Nitrogen" required>

      <label>Phosphorous (in kg per hectare - рдлреЙрд╕реНрдлрд░рд╕ рдкреНрд░рдорд╛рдг):</label>
      <input type="number" name="Phosphorous" required>

      <label>Potassium (in kg per hectare - рдкреЛрдЯреЕрд╢рд┐рдпрдо рдкреНрд░рдорд╛рдг):</label>
      <input type="number" name="Potassium" required>

      <label>Carbon (in percentage - рдорд╛рддреАрддреАрд▓ рдХрд╛рд░реНрдмрди рдЯрдХреНрдХреЗрд╡рд╛рд░реА):</label>
      <input type="number" name="Carbon" required>

       <label>Soil Type (рдорд╛рддреАрдЪрд╛ рдкреНрд░рдХрд╛рд░):</label>
  <select name="Soil" required>
    <option value="">-- рдорд╛рддреА рдирд┐рд╡рдбрд╛ / Select Soil Type --</option>
    <option value="Acidic Soil">Acidic Soil (рдЖрдореНрд▓реАрдп рдорд╛рддреА)</option>
    <option value="Alkaline Soil">Alkaline Soil (рдХреНрд╖рд╛рд░реАрдп рдорд╛рддреА)</option>
    <option value="Loamy Soil">Loamy Soil (рджреБрдкрджреНрд░ рдорд╛рддреА)</option>
    <option value="Neutral Soil">Neutral Soil (рдиреНрдпреВрдЯреНрд░рд▓ рдорд╛рддреА)</option>
    <option value="Peaty Soil">Peaty Soil (рд╣реНрдпреВрдорд╕ рдорд╛рддреА)</option>
  </select>


   <label>Crop Name (рдкрд┐рдХрд╛рдЪреЗ рдирд╛рд╡):</label>
  <select name="Crop" required>
    <option value="">-- рдкреАрдХ рдирд┐рд╡рдбрд╛ / Select Crop --</option>
    <option value="Adzuki Beans">Adzuki Beans (рдЕрдбрдЭреБрдХреА рдмреАрдиреНрд╕)</option>
    <option value="Black gram">Black gram (рдЙрдбреАрдж)</option>
    <option value="Chickpea">Chickpea (рд╣рд░рднрд░рд╛)</option>
    <option value="Coconut">Coconut (рдирд╛рд░рд│)</option>
    <option value="Coffee">Coffee (рдХреЙрдлреА)</option>
    <option value="Cotton">Cotton (рдХрд╛рдкреВрд╕)</option>
    <option value="Ground Nut">Ground Nut (рд╢реЗрдВрдЧрджрд╛рдгрд╛)</option>
    <option value="Jute">Jute (рдкрд╛рдЯрд╛)</option>
    <option value="Kidney Beans">Kidney Beans (рд░рд╛рдЬрдорд╛)</option>
    <option value="Lentil">Lentil (рдорд╕реВрд░)</option>
    <option value="Moth Beans">Moth Beans (рдордЯрдХреА)</option>
    <option value="Mung Bean">Mung Bean (рдореБрдЧ)</option>
    <option value="Peas">Peas (рдордЯрд╛рд░)</option>
    <option value="Pigeon Peas">Pigeon Peas (рддреВрд░)</option>
    <option value="Rubber">Rubber (рд░рдмреНрдмрд░)</option>
    <option value="Sugarcane">Sugarcane (рдКрд╕)</option>
    <option value="Tea">Tea (рдЪрд╣рд╛)</option>
    <option value="Tobacco">Tobacco (рддрдорд╛рдЦреВ)</option>
    <option value="apple">Apple (рд╕рдлрд░рдЪрдВрдж)</option>
    <option value="banana">Banana (рдХреЗрд│реА)</option>
    <option value="grapes">Grapes (рджреНрд░рд╛рдХреНрд╖реЗ)</option>
    <option value="maize">Maize (рдордХрд╛)</option>
    <option value="mango">Mango (рдЖрдВрдмрд╛)</option>
    <option value="millet">Millet (рдмрд╛рдЬрд░реА)</option>
    <option value="muskmelon">Muskmelon (рдЦрд░рдмреВрдЬ)</option>
    <option value="orange">Orange (рд╕рдВрддреНрд░рд╛)</option>
    <option value="papaya">Papaya (рдкрдкрдИ)</option>
    <option value="pomegranate">Pomegranate (рдбрд╛рд│рд┐рдВрдм)</option>
    <option value="rice">Rice (рддрд╛рдВрджреВрд│)</option>
    <option value="watermelon">Watermelon (рдХрд▓рд┐рдВрдЧрдб)</option>
    <option value="wheat">Wheat (рдЧрд╣реВ)</option>
  </select>

      <button type="submit">Get Recommendation</button>
    </form>

    <h3 id="result"></h3>
  </div>

  <script>
    let csvData = [];

    Papa.parse("fertilizer_data.csv", {
      download: true,
      header: true,
      complete: function (results) {
        csvData = results.data;
      }
    });

    document.querySelectorAll('input[type=number]').forEach(input => {
      input.addEventListener('wheel', function (event) {
        event.preventDefault();
      });
    });

    document.getElementById("fertilizerForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const input = Object.fromEntries(formData.entries());

      let bestMatch = null;

      csvData.some(row => {
        try {
          const temp = Math.abs(parseFloat(row.Temperature) - parseFloat(input.Temperature));
          const moist = Math.abs(parseFloat(row.Moisture) * 100 - parseFloat(input.Moisture));
          const rain = Math.abs(parseFloat(row.Rainfall) - parseFloat(input.Rainfall));
          const ph = Math.abs(parseFloat(row.PH) - parseFloat(input.PH));
          const n = Math.abs(parseFloat(row.Nitrogen) - parseFloat(input.Nitrogen));
          const p = Math.abs(parseFloat(row.Phosphorous) - parseFloat(input.Phosphorous));
          const k = Math.abs(parseFloat(row.Potassium) - parseFloat(input.Potassium));
          const c = Math.abs(parseFloat(row.Carbon) * 100 - parseFloat(input.Carbon));

          const soilMatch = row.Soil?.trim().toLowerCase() === input.Soil?.trim().toLowerCase();
          const cropMatch = row.Crop?.trim().toLowerCase() === input.Crop?.trim().toLowerCase();

          if (
            temp <= 5 &&
            moist <= 10 &&
            rain <= 10 &&
            ph <= 1 &&
            n <= 3 &&
            p <= 3 &&
            k <= 3 &&
            c <= 10 &&
            soilMatch &&
            cropMatch
          ) {
            bestMatch = row;
            return true; // stop searching
          }
        } catch (err) {
          console.error("Error comparing row:", err);
        }
        return false;
      });

      const resultDiv = document.getElementById("result");

      if (bestMatch) {
        resultDiv.innerHTML = `
          <h3>ЁЯМ╛ Recommended Fertilizer:</h3>
          <p><strong>${bestMatch.Fertilizer || "Not specified"}</strong></p>
          <h4>ЁЯУЭ Remark:</h4>
          <p>${bestMatch.Remark || "No remark available."}</p>
        `;
      } else {
        resultDiv.innerHTML = "<p><strong>No matching data found. Please check your input values.</strong></p>";
      }
    });
  </script>
</body>